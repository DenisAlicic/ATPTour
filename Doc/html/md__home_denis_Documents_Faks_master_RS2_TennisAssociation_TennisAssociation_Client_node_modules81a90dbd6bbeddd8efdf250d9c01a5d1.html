<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tennis Association: @npmcli/arborist</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Tennis Association
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle">
<div class="title">@npmcli/arborist </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p class="">Inspect and manage <code>node_modules</code> trees.</p>
<p class=""><img src="https://raw.githubusercontent.com/npm/arborist/main/logo.svg?sanitize=true" alt="a tree with the word ARBORIST superimposed on it" style="pointer-events: none;" class="inline"/></p>
<p class="">There's more documentation <a href="https://github.com/npm/arborist/tree/main/notes">in the notes folder</a>.</p>
<h1><a class="anchor" id="autotoc_md15418"></a>
USAGE</h1>
<div class="fragment"><div class="line">const Arborist = require(&#39;@npmcli/arborist&#39;)</div>
<div class="line"> </div>
<div class="line">const arb = new Arborist({</div>
<div class="line">  // options object</div>
<div class="line"> </div>
<div class="line">  // where we&#39;re doing stuff.  defaults to cwd.</div>
<div class="line">  path: &#39;/path/to/package/root&#39;,</div>
<div class="line"> </div>
<div class="line">  // url to the default registry.  defaults to npm&#39;s default registry</div>
<div class="line">  registry: &#39;https://registry.npmjs.org&#39;,</div>
<div class="line"> </div>
<div class="line">  // scopes can be mapped to a different registry</div>
<div class="line">  &#39;@foo:registry&#39;: &#39;https://registry.foo.com/&#39;,</div>
<div class="line"> </div>
<div class="line">  // Auth can be provided in a couple of different ways.  If none are</div>
<div class="line">  // provided, then requests are anonymous, and private packages will 404.</div>
<div class="line">  // Arborist doesn&#39;t do anything with these, it just passes them down</div>
<div class="line">  // the chain to pacote and npm-registry-fetch.</div>
<div class="line"> </div>
<div class="line">  // Safest: a bearer token provided by a registry:</div>
<div class="line">  // 1. an npm auth token, used with the default registry</div>
<div class="line">  token: &#39;deadbeefcafebad&#39;,</div>
<div class="line">  // 2. an alias for the same thing:</div>
<div class="line">  _authToken: &#39;deadbeefcafebad&#39;,</div>
<div class="line"> </div>
<div class="line">  // insecure options:</div>
<div class="line">  // 3. basic auth, username:password, base64 encoded</div>
<div class="line">  auth: &#39;aXNhYWNzOm5vdCBteSByZWFsIHBhc3N3b3Jk&#39;,</div>
<div class="line">  // 4. username and base64 encoded password</div>
<div class="line">  username: &#39;isaacs&#39;,</div>
<div class="line">  password: &#39;bm90IG15IHJlYWwgcGFzc3dvcmQ=&#39;,</div>
<div class="line"> </div>
<div class="line">  // auth configs can also be scoped to a given registry with this</div>
<div class="line">  // rather unusual pattern:</div>
<div class="line">  &#39;//registry.foo.com:token&#39;: &#39;blahblahblah&#39;,</div>
<div class="line">  &#39;//basic.auth.only.foo.com:_auth&#39;: &#39;aXNhYWNzOm5vdCBteSByZWFsIHBhc3N3b3Jk&#39;,</div>
<div class="line">  &#39;//registry.foo.com:always-auth&#39;: true,</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">// READING</div>
<div class="line"> </div>
<div class="line">// returns a promise.  reads the actual contents of node_modules</div>
<div class="line">arb.loadActual().then(tree =&gt; {</div>
<div class="line">  // tree is also stored at arb.virtualTree</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">// read just what the package-lock.json/npm-shrinkwrap says</div>
<div class="line">// This *also* loads the yarn.lock file, but that&#39;s only relevant</div>
<div class="line">// when building the ideal tree.</div>
<div class="line">arb.loadVirtual().then(tree =&gt; {</div>
<div class="line">  // tree is also stored at arb.virtualTree</div>
<div class="line">  // now arb.virtualTree is loaded</div>
<div class="line">  // this fails if there&#39;s no package-lock.json or package.json in the folder</div>
<div class="line">  // note that loading this way should only be done if there&#39;s no</div>
<div class="line">  // node_modules folder</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">// OPTIMIZING AND DESIGNING</div>
<div class="line"> </div>
<div class="line">// build an ideal tree from the package.json and various lockfiles.</div>
<div class="line">arb.buildIdealTree(options).then(() =&gt; {</div>
<div class="line">  // next step is to reify that ideal tree onto disk.</div>
<div class="line">  // options can be:</div>
<div class="line">  // rm: array of package names to remove at top level</div>
<div class="line">  // add: Array of package specifiers to add at the top level.  Each of</div>
<div class="line">  //   these will be resolved with pacote.manifest if the name can&#39;t be</div>
<div class="line">  //   determined from the spec.  (Eg, `github:foo/bar` vs `foo@somespec`.)</div>
<div class="line">  //   The dep will be saved in the location where it already exists,</div>
<div class="line">  //   (or pkg.dependencies) unless a different saveType is specified.</div>
<div class="line">  // saveType: Save added packages in a specific dependency set.</div>
<div class="line">  //   - null (default) Wherever they exist already, or &#39;dependencies&#39;</div>
<div class="line">  //   - prod: definitely in &#39;dependencies&#39;</div>
<div class="line">  //   - optional: in &#39;optionalDependencies&#39;</div>
<div class="line">  //   - dev: devDependencies</div>
<div class="line">  //   - peer: save in peerDependencies, and remove any optional flag from</div>
<div class="line">  //     peerDependenciesMeta if one exists</div>
<div class="line">  //   - peerOptional: save in peerDependencies, and add a</div>
<div class="line">  //     peerDepsMeta[name].optional flag</div>
<div class="line">  // saveBundle: add newly added deps to the bundleDependencies list</div>
<div class="line">  // update: Either `true` to just go ahead and update everything, or an</div>
<div class="line">  //   object with any or all of the following fields:</div>
<div class="line">  //   - all: boolean.  set to true to just update everything</div>
<div class="line">  //   - names: names of packages update (like `npm update foo`)</div>
<div class="line">  // prune: boolean, default true.  Prune extraneous nodes from the tree.</div>
<div class="line">  // preferDedupe: prefer to deduplicate packages if possible, rather than</div>
<div class="line">  //   choosing a newer version of a dependency.  Defaults to false, ie,</div>
<div class="line">  //   always try to get the latest and greatest deps.</div>
<div class="line">  // legacyBundling: Nest every dep under the node requiring it, npm v2 style.</div>
<div class="line">  //   No unnecessary deduplication.  Default false.</div>
<div class="line"> </div>
<div class="line">  // At the end of this process, arb.idealTree is set.</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">// WRITING</div>
<div class="line"> </div>
<div class="line">// Make the idealTree be the thing that&#39;s on disk</div>
<div class="line">arb.reify({</div>
<div class="line">  // write the lockfile(s) back to disk, and package.json with any updates</div>
<div class="line">  // defaults to &#39;true&#39;</div>
<div class="line">  save: true,</div>
<div class="line">}).then(() =&gt; {</div>
<div class="line">  // node modules has been written to match the idealTree</div>
<div class="line">})</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md15419"></a>
DATA STRUCTURES</h1>
<p class="">A <code>node_modules</code> tree is a logical graph of dependencies overlaid on a physical tree of folders.</p>
<p class="">A <code>Node</code> represents a package folder on disk, either at the root of the package, or within a <code>node_modules</code> folder. The physical structure of the folder tree is represented by the <code>node.parent</code> reference to the containing folder, and <code>node.children</code> map of nodes within its <code>node_modules</code> folder, where the key in the map is the name of the folder in <code>node_modules</code>, and the value is the child node.</p>
<p class="">A node without a parent is a top of tree.</p>
<p class="">A <code>Link</code> represents a symbolic link to a package on disk. This can be a symbolic link to a package folder within the current tree, or elsewhere on disk. The <code>link.target</code> is a reference to the actual node. Links differ from Nodes in that dependencies are resolved from the <em>target</em> location, rather than from the link location.</p>
<p class="">An <code>Edge</code> represents a dependency relationship. Each node has an <code>edgesIn</code> set, and an <code>edgesOut</code> map. Each edge has a <code>type</code> which specifies what kind of dependency it represents: &lsquo;'prod&rsquo;<code>for regular dependencies, </code>'peer'<code>for peerDependencies,</code>'dev'<code>for devDependencies, and </code>'optional'<code>for optionalDependencies.</code>edge.from&lt;tt&gt;is a reference to the node that has the dependency, andedge.to` is a reference to the node that requires the dependency.</p>
<p class="">As nodes are moved around in the tree, the graph edges are automatically updated to point at the new module resolution targets. In other words, <code>edge.from</code>, <code>edge.name</code>, and <code>edge.spec</code> are immutable; <code>edge.to</code> is updated automatically when a node's parent changes.</p>
<h2><a class="anchor" id="autotoc_md15420"></a>
class Node</h2>
<p class="">All arborist trees are <code>Node</code> objects. A <code>Node</code> refers to a package folder, which may have children in <code>node_modules</code>.</p>
<ul>
<li><code>node.name</code> The name of this node's folder in <code>node_modules</code>.</li>
<li><p class="startli"><code>node.parent</code> Physical parent node in the tree. The package in whose <code>node_modules</code> folder this package lives. Null if node is top of tree.</p>
<p class="startli">Setting <code>node.parent</code> will automatically update <code>node.location</code> and all graph edges affected by the move.</p>
</li>
<li><code>node.meta</code> A <code>Shrinkwrap</code> object which looks up <code>resolved</code> and <code>integrity</code> values for all modules in this tree. Only relevant on <code>root</code> nodes.</li>
<li><code>node.children</code> Map of packages located in the node's <code>node_modules</code> folder.</li>
<li><code>node.package</code> The contents of this node's <code>package.json</code> file.</li>
<li><code>node.path</code> File path to this package. If the node is a link, then this is the path to the link, not to the link target. If the node is <em>not</em> a link, then this matches <code>node.realpath</code>.</li>
<li><code>node.realpath</code> The full real filepath on disk where this node lives.</li>
<li><code>node.location</code> A slash-normalized relative path from the root node to this node's path.</li>
<li><code>node.isLink</code> Whether this represents a symlink. Always <code>false</code> for Node objects, always <code>true</code> for Link objects.</li>
<li><code>node.isRoot</code> True if this node is a root node. (Ie, if <code>node.root === node</code>.)</li>
<li><code>node.root</code> The root node where we are working. If not assigned to some other value, resolves to the node itself. (Ie, the root node's <code>root</code> property refers to itself.)</li>
<li><code>node.isTop</code> True if this node is the top of its tree (ie, has no <code>parent</code>, false otherwise).</li>
<li><code>node.top</code> The top node in this node's tree. This will be equal to <code>node.root</code> for simple trees, but link targets will frequently be outside of (or nested somewhere within) a <code>node_modules</code> hierarchy, and so will have a different <code>top</code>.</li>
<li><code>node.dev</code>, <code>node.optional</code>, <code>node.devOptional</code>, <code>node.peer</code>, Indicators as to whether this node is a dev, optional, and/or peer dependency. These flags are relevant when pruning dependencies out of the tree or deciding what to reify. See <b>Package Dependency Flags</b> below for explanations.</li>
<li><code>node.edgesOut</code> Edges in the dependency graph indicating nodes that this node depends on, which resolve its dependencies.</li>
<li><code>node.edgesIn</code> Edges in the dependency graph indicating nodes that depend on this node.</li>
<li><code>extraneous</code> True if this package is not required by any other for any reason. False for top of tree.</li>
<li><code>node.resolve(name)</code> Identify the node that will be returned when code in this package runs <code>require(name)</code></li>
<li><code>node.errors</code> Array of errors encountered while parsing package.json or version specifiers.</li>
</ul>
<h2><a class="anchor" id="autotoc_md15421"></a>
class Link</h2>
<p class="">Link objects represent a symbolic link within the <code>node_modules</code> folder. They have most of the same properties and methods as <code>Node</code> objects, with a few differences.</p>
<ul>
<li><code>link.target</code> A Node object representing the package that the link references. If this is a Node already present within the tree, then it will be the same object. If it's outside of the tree, then it will be treated as the top of its own tree.</li>
<li><code>link.isLink</code> Always true.</li>
<li><code>link.children</code> This is always an empty map, since links don't have their own children directly.</li>
</ul>
<h2><a class="anchor" id="autotoc_md15422"></a>
class Edge</h2>
<p class="">Edge objects represent a dependency relationship a package node to the point in the tree where the dependency will be loaded. As nodes are moved within the tree, Edges automatically update to point to the appropriate location.</p>
<ul>
<li><code>new Edge({ from, type, name, spec })</code> Creates a new edge with the specified fields. After instantiation, none of the fields can be changed directly.</li>
<li><code>edge.from</code> The node that has the dependency.</li>
<li><code>edge.type</code> The type of dependency. One of &lsquo;'prod&rsquo;<code>,</code>'dev'<code>,</code>'peer'<code>, or</code>'optional'<code>. *</code>edge.name&lt;tt&gt;The name of the dependency. Ie, the key in the relevantpackage.json&lt;tt&gt;dependencies object. *edge.spec` The specifier that is required. This can be a version, range, tag name, git url, or tarball URL. Any specifier allowed by npm is supported.</li>
<li><code>edge.to</code> Automatically set to the node in the tree that matches the <code>name</code> field.</li>
<li><code>edge.valid</code> True if <code>edge.to</code> satisfies the specifier.</li>
<li><code>edge.error</code> A string indicating the type of error if there is a problem, or <code>null</code> if it's valid. Values, in order of precedence:<ul>
<li><code>DETACHED</code> Indicates that the edge has been detached from its <code>edge.from</code> node, typically because a new edge was created when a dependency specifier was modified.</li>
<li><code>MISSING</code> Indicates that the dependency is unmet. Note that this is <em>not</em> set for unmet dependencies of the <code>optional</code> type.</li>
<li><code>PEER LOCAL</code> Indicates that a <code>peerDependency</code> is found in the node's local <code>node_modules</code> folder, and the node is not the top of the tree. This violates the <code>peerDependency</code> contract, because it means that the dependency is not a peer.</li>
<li><code>INVALID</code> Indicates that the dependency does not satisfy <code>edge.spec</code>.</li>
</ul>
</li>
<li><code>edge.reload()</code> Re-resolve to find the appropriate value for <code>edge.to</code>. Called automatically from the <code>Node</code> class when the tree is mutated.</li>
</ul>
<h2><a class="anchor" id="autotoc_md15423"></a>
Package Dependency Flags</h2>
<p class="">The dependency type of a node can be determined efficiently by looking at the <code>dev</code>, <code>optional</code>, and <code>devOptional</code> flags on the node object. These are updated by arborist when necessary whenever the tree is modified in such a way that the dependency graph can change, and are relevant when pruning nodes from the tree.</p>
<div class="fragment"><div class="line">| extraneous | peer | dev | optional | devOptional | meaning             | prune?            |</div>
<div class="line">|------------+------+-----+----------+-------------+---------------------+-------------------|</div>
<div class="line">|            |      |     |          |             | production dep      | never             |</div>
<div class="line">|------------+------+-----+----------+-------------+---------------------+-------------------|</div>
<div class="line">|     X      | N/A  | N/A |   N/A    |     N/A     | nothing depends on  | always            |</div>
<div class="line">|            |      |     |          |             | this, it is trash   |                   |</div>
<div class="line">|------------+------+-----+----------+-------------+---------------------+-------------------|</div>
<div class="line">|            |      |  X  |          |      X      | devDependency, or   | if pruning dev    |</div>
<div class="line">|            |      |     |          | not in lock | only depended upon  |                   |</div>
<div class="line">|            |      |     |          |             | by devDependencies  |                   |</div>
<div class="line">|------------+------+-----+----------+-------------+---------------------+-------------------|</div>
<div class="line">|            |      |     |    X     |      X      | optionalDependency, | if pruning        |</div>
<div class="line">|            |      |     |          | not in lock | or only depended on | optional          |</div>
<div class="line">|            |      |     |          |             | by optionalDeps     |                   |</div>
<div class="line">|------------+------+-----+----------+-------------+---------------------+-------------------|</div>
<div class="line">|            |      |  X  |    X     |      X      | Optional dependency | if pruning EITHER |</div>
<div class="line">|            |      |     |          | not in lock | of dep(s) in the    | dev OR optional   |</div>
<div class="line">|            |      |     |          |             | dev hierarchy       |                   |</div>
<div class="line">|------------+------+-----+----------+-------------+---------------------+-------------------|</div>
<div class="line">|            |      |     |          |      X      | BOTH a non-optional | if pruning BOTH   |</div>
<div class="line">|            |      |     |          |   in lock   | dep within the dev  | dev AND optional  |</div>
<div class="line">|            |      |     |          |             | hierarchy, AND a    |                   |</div>
<div class="line">|            |      |     |          |             | dep within the      |                   |</div>
<div class="line">|            |      |     |          |             | optional hierarchy  |                   |</div>
<div class="line">|------------+------+-----+----------+-------------+---------------------+-------------------|</div>
<div class="line">|            |  X   |     |          |             | peer dependency, or | if pruning peers  |</div>
<div class="line">|            |      |     |          |             | only depended on by |                   |</div>
<div class="line">|            |      |     |          |             | peer dependencies   |                   |</div>
<div class="line">|------------+------+-----+----------+-------------+---------------------+-------------------|</div>
<div class="line">|            |  X   |  X  |          |      X      | peer dependency of  | if pruning peer   |</div>
<div class="line">|            |      |     |          | not in lock | dev node hierarchy  | OR dev deps       |</div>
<div class="line">|------------+------+-----+----------+-------------+---------------------+-------------------|</div>
<div class="line">|            |  X   |     |    X     |      X      | peer dependency of  | if pruning peer   |</div>
<div class="line">|            |      |     |          | not in lock | optional nodes, or  | OR optional deps  |</div>
<div class="line">|            |      |     |          |             | peerOptional dep    |                   |</div>
<div class="line">|------------+------+-----+----------+-------------+---------------------+-------------------|</div>
<div class="line">|            |  X   |  X  |    X     |      X      | peer optional deps  | if pruning peer   |</div>
<div class="line">|            |      |     |          | not in lock | of the dev dep      | OR optional OR    |</div>
<div class="line">|            |      |     |          |             | hierarchy           | dev               |</div>
<div class="line">|------------+------+-----+----------+-------------+---------------------+-------------------|</div>
<div class="line">|            |  X   |     |          |      X      | BOTH a non-optional | if pruning peers  |</div>
<div class="line">|            |      |     |          |   in lock   | peer dep within the | OR:               |</div>
<div class="line">|            |      |     |          |             | dev hierarchy, AND  | BOTH optional     |</div>
<div class="line">|            |      |     |          |             | a peer optional dep | AND dev deps      |</div>
<div class="line">+------------+------+-----+----------+-------------+---------------------+-------------------+</div>
</div><!-- fragment --><ul>
<li>If none of these flags are set, then the node is required by the dependency and/or peerDependency hierarchy. It should not be pruned.</li>
<li>If <em>both</em> <code>node.dev</code> and <code>node.optional</code> are set, then the node is an optional dependency of one of the packages in the devDependency hierarchy. It should be pruned if <em>either</em> dev or optional deps are being removed.</li>
<li>If <code>node.dev</code> is set, but <code>node.optional</code> is not, then the node is required in the devDependency hierarchy. It should be pruned if dev dependencies are being removed.</li>
<li>If <code>node.optional</code> is set, but <code>node.dev</code> is not, then the node is required in the optionalDependency hierarchy. It should be pruned if optional dependencies are being removed.</li>
<li>If <code>node.devOptional</code> is set, then the node is a (non-optional) dependency within the devDependency hierarchy, <em>and</em> a dependency within the <code>optionalDependency</code> hierarchy. It should be pruned if <em>both</em> dev and optional dependencies are being removed.</li>
<li>If <code>node.peer</code> is set, then all the same semantics apply as above, except that the dep is brought in by a peer dep at some point, rather than a normal non-peer dependency.</li>
</ul>
<p class="">Note: <code>devOptional</code> is only set in the shrinkwrap/package-lock file if <em>neither</em> <code>dev</code> nor <code>optional</code> are set, as it would be redundant. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
