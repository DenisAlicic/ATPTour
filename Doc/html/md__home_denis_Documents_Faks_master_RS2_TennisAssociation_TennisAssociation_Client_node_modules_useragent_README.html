<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tennis Association: useragent - high performance user agent parser for Node.js</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Tennis Association
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle">
<div class="title">useragent - high performance user agent parser for Node.js </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p class="">Useragent originated as port of <a href="http://www.browserscope.org/">browserscope.org</a>'s user agent parser project also known as ua-parser. Useragent allows you to parse user agent string with high accuracy by using hand tuned dedicated regular expressions for browser matching. This database is needed to ensure that every browser is correctly parsed as every browser vendor implements it's own user agent schema. This is why regular user agent parsers have major issues because they will most likely parse out the wrong browser name or confuse the render engine version with the actual version of the browser.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md3616"></a>
Build status &lt;a href="http://travis-ci.org/3rd-Eden/useragent"&gt;&lt;img src="https://secure.travis-ci.org/3rd-Eden/useragent.png?branch=master" alt="BuildStatus"/&gt;&lt;/a&gt;</h2>
<hr  />
<h2><a class="anchor" id="autotoc_md3618"></a>
High performance</h2>
<p class="">The module has been developed with a benchmark driven approach. It has a pre-compiled library that contains all the Regular Expressions and uses deferred or on demand parsing for Operating System and device information. All this engineering effort has been worth it as <a href="/3rd-Eden/useragent/blob/master/benchmark/run.js">this benchmark shows</a>:</p>
<div class="fragment"><div class="line">Starting the benchmark, parsing 62 useragent strings per run</div>
<div class="line"> </div>
<div class="line">Executed benchmark against node module: &quot;useragent&quot;</div>
<div class="line">Count (61), Cycles (5), Elapsed (5.559), Hz (1141.3739447904327)</div>
<div class="line"> </div>
<div class="line">Executed benchmark against node module: &quot;useragent_parser&quot;</div>
<div class="line">Count (29), Cycles (3), Elapsed (5.448), Hz (545.6817291171243)</div>
<div class="line"> </div>
<div class="line">Executed benchmark against node module: &quot;useragent-parser&quot;</div>
<div class="line">Count (16), Cycles (4), Elapsed (5.48), Hz (304.5373431830105)</div>
<div class="line"> </div>
<div class="line">Executed benchmark against node module: &quot;ua-parser&quot;</div>
<div class="line">Count (54), Cycles (3), Elapsed (5.512), Hz (1018.7561434659247)</div>
<div class="line"> </div>
<div class="line">Module: &quot;useragent&quot; is the user agent fastest parser.</div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md3620"></a>
Installation</h2>
<p class="">Installation is done using the Node Package Manager (NPM). If you don't have NPM installed on your system you can download it from <a href="http://npmjs.org">npmjs.org</a></p>
<div class="fragment"><div class="line">npm install useragent --save</div>
</div><!-- fragment --><p class="">The <code>--save</code> flag tells NPM to automatically add it to your <code>package.json</code> file.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md3622"></a>
API</h2>
<p class="">Include the <code>useragent</code> parser in you node.js application:</p>
<div class="fragment"><div class="line">var useragent = require(&#39;useragent&#39;);</div>
</div><!-- fragment --><p class="">The <code>useragent</code> library allows you do use the automatically installed RegExp library or you can fetch it live from the remote servers. So if you are paranoid and always want your RegExp library to be up to date to match with agent the widest range of <code>useragent</code> strings you can do:</p>
<div class="fragment"><div class="line">var useragent = require(&#39;useragent&#39;);</div>
<div class="line">useragent(true);</div>
</div><!-- fragment --><p class="">This will async load the database from the server and compile it to a proper JavaScript supported format. If it fails to compile or load it from the remote location it will just fall back silently to the shipped version. If you want to use this feature you need to add <code>yamlparser</code> and <code>request</code> to your package.json</p>
<div class="fragment"><div class="line">npm install yamlparser --save</div>
<div class="line">npm install request --save</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md3623"></a>
useragent.parse(useragent string[, js useragent]);</h3>
<p class="">This is the actual user agent parser, this is where all the magic is happening. The function accepts 2 arguments, both should be a <code>string</code>. The first argument should the user agent string that is known on the server from the <code>req.headers.useragent</code> header. The other argument is optional and should be the user agent string that you see in the browser, this can be send from the browser using a xhr request or something like this. This allows you detect if the user is browsing the web using the <code>Chrome Frame</code> extension.</p>
<p class="">The parser returns a Agent instance, this allows you to output user agent information in different predefined formats. See the Agent section for more information.</p>
<div class="fragment"><div class="line">var agent = useragent.parse(req.headers[&#39;user-agent&#39;]);</div>
<div class="line"> </div>
<div class="line">// example for parsing both the useragent header and a optional js useragent</div>
<div class="line">var agent2 = useragent.parse(req.headers[&#39;user-agent&#39;], req.query.jsuseragent);</div>
</div><!-- fragment --><p class="">The parse method returns a <code>Agent</code> instance which contains all details about the user agent. See the Agent section of the API documentation for the available methods.</p>
<h3><a class="anchor" id="autotoc_md3624"></a>
useragent.lookup(useragent string[, js useragent]);</h3>
<p class="">This provides the same functionality as above, but it caches the user agent string and it's parsed result in memory to provide faster lookups in the future. This can be handy if you expect to parse a lot of user agent strings.</p>
<p class="">It uses the same arguments as the <code>useragent.parse</code> method and returns exactly the same result, but it's just cached.</p>
<div class="fragment"><div class="line">var agent = useragent.lookup(req.headers[&#39;user-agent&#39;]);</div>
</div><!-- fragment --><p class="">And this is a serious performance improvement as shown in this benchmark:</p>
<div class="fragment"><div class="line">Executed benchmark against method: &quot;useragent.parse&quot;</div>
<div class="line">Count (49), Cycles (3), Elapsed (5.534), Hz (947.6844321931629)</div>
<div class="line"> </div>
<div class="line">Executed benchmark against method: &quot;useragent.lookup&quot;</div>
<div class="line">Count (11758), Cycles (3), Elapsed (5.395), Hz (229352.03831239208)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md3625"></a>
useragent.fromJSON(obj);</h3>
<p class="">Transforms the JSON representation of a <code>Agent</code> instance back in to a working <code>Agent</code> instance</p>
<div class="fragment"><div class="line">var agent = useragent.parse(req.headers[&#39;user-agent&#39;])</div>
<div class="line">  , another = useragent.fromJSON(JSON.stringify(agent));</div>
<div class="line"> </div>
<div class="line">console.log(agent == another);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md3626"></a>
useragent.is(useragent string).browsername;</h3>
<p class="">This api provides you with a quick and dirty browser lookup. The underlying code is usually found on client side scripts so it's not the same quality as our <code>useragent.parse</code> method but it might be needed for legacy reasons.</p>
<p class=""><code>useragent.is</code> returns a object with potential matched browser names</p>
<div class="fragment"><div class="line">useragent.is(req.headers[&#39;user-agent&#39;]).firefox // true</div>
<div class="line">useragent.is(req.headers[&#39;user-agent&#39;]).safari // false</div>
<div class="line">var ua = useragent.is(req.headers[&#39;user-agent&#39;])</div>
<div class="line"> </div>
<div class="line">// the object</div>
<div class="line">{</div>
<div class="line">  version: &#39;3&#39;</div>
<div class="line">  webkit: false</div>
<div class="line">  opera: false</div>
<div class="line">  ie: false</div>
<div class="line">  chrome: false</div>
<div class="line">  safari: false</div>
<div class="line">  mobile_safari: false</div>
<div class="line">  firefox: true</div>
<div class="line">  mozilla: true</div>
<div class="line">  android: false</div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md3628"></a>
Agents, OperatingSystem and Device instances</h2>
<p class="">Most of the methods mentioned above return a Agent instance. The Agent exposes the parsed out information from the user agent strings. This allows us to extend the agent with more methods that do not necessarily need to be in the core agent instance, allowing us to expose a plugin interface for third party developers and at the same time create a uniform interface for all versioning.</p>
<p class="">The Agent has the following property</p>
<ul>
<li><code>family</code> The browser family, or browser name, it defaults to Other.</li>
<li><code>major</code> The major version number of the family, it defaults to 0.</li>
<li><code>minor</code> The minor version number of the family, it defaults to 0.</li>
<li><code>patch</code> The patch version number of the family, it defaults to 0.</li>
</ul>
<p class="">In addition to the properties mentioned above, it also has 2 special properties, which are:</p>
<ul>
<li><code>os</code> OperatingSystem instance</li>
<li><code>device</code> Device instance</li>
</ul>
<p class="">When you access those 2 properties the agent will do on demand parsing of the Operating System or/and Device information.</p>
<p class="">The OperatingSystem has the same properties as the Agent, for the Device we don't have any versioning information available, so only the <code>family</code> property is set there. If we cannot find the family, they will default to <code>Other</code>.</p>
<p class="">The following methods are available:</p>
<h3><a class="anchor" id="autotoc_md3629"></a>
Agent.toAgent();</h3>
<p class="">Returns the family and version number concatinated in a nice human readable string.</p>
<div class="fragment"><div class="line">var agent = useragent.parse(req.headers[&#39;user-agent&#39;]);</div>
<div class="line">agent.toAgent(); // &#39;Chrome 15.0.874&#39;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md3630"></a>
Agent.toString();</h3>
<p class="">Returns the results of the <code>Agent.toAgent()</code> but also adds the parsed operating system to the string in a human readable format.</p>
<div class="fragment"><div class="line">var agent = useragent.parse(req.headers[&#39;user-agent&#39;]);</div>
<div class="line">agent.toString(); // &#39;Chrome 15.0.874 / Mac OS X 10.8.1&#39;</div>
<div class="line"> </div>
<div class="line">// as it&#39;s a to string method you can also concat it with another string</div>
<div class="line">&#39;your useragent is &#39; + agent;</div>
<div class="line">// &#39;your useragent is Chrome 15.0.874 / Mac OS X 10.8.1&#39;</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md3631"></a>
Agent.toVersion();</h3>
<p class="">Returns the version of the browser in a human readable string.</p>
<div class="fragment"><div class="line">var agent = useragent.parse(req.headers[&#39;user-agent&#39;]);</div>
<div class="line">agent.toVersion(); // &#39;15.0.874&#39;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md3632"></a>
Agent.toJSON();</h3>
<p class="">Generates a JSON representation of the Agent. By using the <code>toJSON</code> method we automatically allow it to be stringified when supplying as to the <code>JSON.stringify</code> method.</p>
<div class="fragment"><div class="line">var agent = useragent.parse(req.headers[&#39;user-agent&#39;]);</div>
<div class="line">agent.toJSON(); // returns an object</div>
<div class="line"> </div>
<div class="line">JSON.stringify(agent);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md3633"></a>
OperatingSystem.toString();</h3>
<p class="">Generates a stringified version of operating system;</p>
<div class="fragment"><div class="line">var agent = useragent.parse(req.headers[&#39;user-agent&#39;]);</div>
<div class="line">agent.os.toString(); // &#39;Mac OSX 10.8.1&#39;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md3634"></a>
OperatingSystem.toVersion();</h3>
<p class="">Generates a stringified version of operating system's version;</p>
<div class="fragment"><div class="line">var agent = useragent.parse(req.headers[&#39;user-agent&#39;]);</div>
<div class="line">agent.os.toVersion(); // &#39;10.8.1&#39;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md3635"></a>
OperatingSystem.toJSON();</h3>
<p class="">Generates a JSON representation of the OperatingSystem. By using the <code>toJSON</code> method we automatically allow it to be stringified when supplying as to the <code>JSON.stringify</code> method.</p>
<div class="fragment"><div class="line">var agent = useragent.parse(req.headers[&#39;user-agent&#39;]);</div>
<div class="line">agent.os.toJSON(); // returns an object</div>
<div class="line"> </div>
<div class="line">JSON.stringify(agent.os);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md3636"></a>
Device.toString();</h3>
<p class="">Generates a stringified version of device;</p>
<div class="fragment"><div class="line">var agent = useragent.parse(req.headers[&#39;user-agent&#39;]);</div>
<div class="line">agent.device.toString(); // &#39;Asus A100&#39;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md3637"></a>
Device.toVersion();</h3>
<p class="">Generates a stringified version of device's version;</p>
<div class="fragment"><div class="line">var agent = useragent.parse(req.headers[&#39;user-agent&#39;]);</div>
<div class="line">agent.device.toVersion(); // &#39;&#39; , no version found but could also be &#39;0.0.0&#39;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md3638"></a>
Device.toJSON();</h3>
<p class="">Generates a JSON representation of the Device. By using the <code>toJSON</code> method we automatically allow it to be stringified when supplying as to the <code>JSON.stringify</code> method.</p>
<div class="fragment"><div class="line">var agent = useragent.parse(req.headers[&#39;user-agent&#39;]);</div>
<div class="line">agent.device.toJSON(); // returns an object</div>
<div class="line"> </div>
<div class="line">JSON.stringify(agent.device);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3639"></a>
Adding more features to the useragent</h2>
<p class="">As I wanted to keep the core of the user agent parser as clean and fast as possible I decided to move some of the initially planned features to a new <code>plugin</code> file.</p>
<p class="">These extensions to the Agent prototype can be loaded by requiring the <code>useragent/features</code> file:</p>
<div class="fragment"><div class="line">var useragent = require(&#39;useragent&#39;);</div>
<div class="line">require(&#39;useragent/features&#39;);</div>
</div><!-- fragment --><p class="">The initial release introduces 1 new method, satisfies, which allows you to see if the version number of the browser satisfies a certain range. It uses the semver library to do all the range calculations but here is a small summary of the supported range styles:</p>
<ul>
<li><code>&gt;1.2.3</code> Greater than a specific version.</li>
<li><code>&lt;1.2.3</code> Less than.</li>
<li><code>1.2.3 - 2.3.4</code> := <code>&gt;=1.2.3 &lt;=2.3.4</code>.</li>
<li><code>~1.2.3</code> := <code>&gt;=1.2.3 &lt;1.3.0</code>.</li>
<li><code>~1.2</code> := <code>&gt;=1.2.0 &lt;2.0.0</code>.</li>
<li><code>~1</code> := <code>&gt;=1.0.0 &lt;2.0.0</code>.</li>
<li><code>1.2.x</code> := <code>&gt;=1.2.0 &lt;1.3.0</code>.</li>
<li><code>1.x</code> := <code>&gt;=1.0.0 &lt;2.0.0</code>.</li>
</ul>
<p class="">As it requires the <code>semver</code> module to function you need to install it seperately:</p>
<div class="fragment"><div class="line">npm install semver --save</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md3640"></a>
Agent.satisfies('range style here');</h3>
<p class="">Check if the agent matches the supplied range.</p>
<div class="fragment"><div class="line">var agent = useragent.parse(req.headers[&#39;user-agent&#39;]);</div>
<div class="line">agent.satisfies(&#39;15.x || &gt;=19.5.0 || 25.0.0 - 17.2.3&#39;); // true</div>
<div class="line">agent.satisfies(&#39;&gt;16.12.0&#39;); // false</div>
</div><!-- fragment --> <hr  />
<h2><a class="anchor" id="autotoc_md3642"></a>
Migrations</h2>
<p class="">For small changes between version please review the changelog.</p>
<h3><a class="anchor" id="autotoc_md3643"></a>
Upgrading from 1.10 to 2.0.0</h3>
<ul>
<li><code>useragent.fromAgent</code> has been removed.</li>
<li><code>agent.toJSON</code> now returns an Object, use <code>JSON.stringify(agent)</code> for the old behaviour.</li>
<li><code>agent.os</code> is now an <code>OperatingSystem</code> instance with version numbers. If you still a string only representation do <code>agent.os.toString()</code>.</li>
<li><code>semver</code> has been removed from the dependencies, so if you are using the &lsquo;require('useragent/features&rsquo;)` you need to add it to your own dependencies</li>
</ul>
<h3><a class="anchor" id="autotoc_md3644"></a>
Upgrading from 0.1.2 to 1.0.0</h3>
<ul>
<li><code>useragent.browser(ua)</code> has been renamed to <code>useragent.is(ua)</code>.</li>
<li><code>useragent.parser(ua, jsua)</code> has been renamed to <code>useragent.parse(ua, jsua)</code>.</li>
<li><code>result.pretty()</code> has been renamed to <code>result.toAgent()</code>.</li>
<li><code>result.V1</code> has been renamed to <code>result.major</code>.</li>
<li><code>result.V2</code> has been renamed to <code>result.minor</code>.</li>
<li><code>result.V3</code> has been renamed to <code>result.patch</code>.</li>
<li><code>result.prettyOS()</code> has been removed.</li>
<li><code>result.match</code> has been removed.</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md3646"></a>
License</h2>
<p class="">MIT </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
