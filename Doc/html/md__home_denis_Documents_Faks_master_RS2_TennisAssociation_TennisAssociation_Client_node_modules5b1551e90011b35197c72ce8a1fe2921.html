<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tennis Association: libnpmversion</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Tennis Association
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle">
<div class="title">libnpmversion </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p class="">Library to do the things that 'npm version' does.</p>
<h1><a class="anchor" id="autotoc_md14902"></a>
USAGE</h1>
<div class="fragment"><div class="line">const npmVersion = require(&#39;libnpmversion&#39;)</div>
<div class="line"> </div>
<div class="line">// argument can be one of:</div>
<div class="line">// - any semver version string (set to that exact version)</div>
<div class="line">// - &#39;major&#39;, &#39;minor&#39;, &#39;patch&#39;, &#39;pre{major,minor,patch}&#39; (increment at</div>
<div class="line">//   that value)</div>
<div class="line">// - &#39;from-git&#39; (set to the latest semver-lookin git tag - this skips</div>
<div class="line">//   gitTagVersion, but will still sign if asked)</div>
<div class="line">npmVersion(arg, {</div>
<div class="line">  path: &#39;/path/to/my/pkg&#39;, // defaults to cwd</div>
<div class="line"> </div>
<div class="line">  allowSameVersion: false, // allow tagging/etc to the current version</div>
<div class="line">  preid: &#39;&#39;, // when arg==&#39;pre&#39;, define the prerelease string, like &#39;beta&#39; etc.</div>
<div class="line">  tagVersionPrefix: &#39;v&#39;, // tag as &#39;v1.2.3&#39; when versioning to 1.2.3</div>
<div class="line">  commitHooks: true, // default true, run git commit hooks, default true</div>
<div class="line">  gitTagVersion: true, // default true, tag the version</div>
<div class="line">  signGitCommit: false, // default false, gpg sign the git commit</div>
<div class="line">  signGitTag: false, // default false, gpg sign the git tag</div>
<div class="line">  force: false, // push forward recklessly if any problems happen</div>
<div class="line">  ignoreScripts: false, // do not run pre/post/version lifecycle scripts</div>
<div class="line">  scriptShell: &#39;/bin/bash&#39;, // shell to run lifecycle scripts in</div>
<div class="line">  message: &#39;v%s&#39;, // message for tag and commit, replace %s with the version</div>
<div class="line">}).then(newVersion =&gt; {</div>
<div class="line">  console.error(&#39;version updated!&#39;, newVersion)</div>
<div class="line">})</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md14903"></a>
Description</h1>
<p class="">Run this in a package directory to bump the version and write the new data back to <code>package.json</code>, <code>package-lock.json</code>, and, if present, <code>npm-shrinkwrap.json</code>.</p>
<p class="">The <code>newversion</code> argument should be a valid semver string, a valid second argument to <a href="https://github.com/npm/node-semver#functions">semver.inc</a> (one of <code>patch</code>, <code>minor</code>, <code>major</code>, <code>prepatch</code>, <code>preminor</code>, <code>premajor</code>, <code>prerelease</code>), or <code>from-git</code>. In the second case, the existing version will be incremented by 1 in the specified field. <code>from-git</code> will try to read the latest git tag, and use that as the new npm version.</p>
<p class="">If run in a git repo, it will also create a version commit and tag. This behavior is controlled by <code>gitTagVersion</code> (see below), and can be disabled by setting <code>gitTagVersion: false</code> in the options. It will fail if the working directory is not clean, unless <code>force: true</code> is set.</p>
<p class="">If supplied with a <code>message</code> string option, it will use it as a commit message when creating a version commit. If the <code>message</code> option contains <code>s</code> then that will be replaced with the resulting version number.</p>
<p class="">If the <code>signGitTag</code> option is set, then the tag will be signed using the <code>-s</code> flag to git. Note that you must have a default GPG key set up in your git config for this to work properly.</p>
<p class="">If <code>preversion</code>, <code>version</code>, or <code>postversion</code> are in the <code>scripts</code> property of the package.json, they will be executed in the appropriate sequence.</p>
<p class="">The exact order of execution is as follows:</p>
<ol type="1">
<li>Check to make sure the git working directory is clean before we get started. Your scripts may add files to the commit in future steps. This step is skipped if the <code>force</code> flag is set.</li>
<li>Run the <code>preversion</code> script. These scripts have access to the old <code>version</code> in package.json. A typical use would be running your full test suite before deploying. Any files you want added to the commit should be explicitly added using <code>git add</code>.</li>
<li>Bump <code>version</code> in <code>package.json</code> as requested (<code>patch</code>, <code>minor</code>, <code>major</code>, explicit version number, etc).</li>
<li>Run the <code>version</code> script. These scripts have access to the new <code>version</code> in package.json (so they can incorporate it into file headers in generated files for example). Again, scripts should explicitly add generated files to the commit using <code>git add</code>.</li>
<li>Commit and tag.</li>
<li>Run the <code>postversion</code> script. Use it to clean up the file system or automatically push the commit and/or tag.</li>
</ol>
<p class="">Take the following example:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;scripts&quot;: {</div>
<div class="line">    &quot;preversion&quot;: &quot;npm test&quot;,</div>
<div class="line">    &quot;version&quot;: &quot;npm run build &amp;&amp; git add -A dist&quot;,</div>
<div class="line">    &quot;postversion&quot;: &quot;git push &amp;&amp; git push --tags &amp;&amp; rm -rf build/temp&quot;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p class="">This runs all your tests, and proceeds only if they pass. Then runs your <code>build</code> script, and adds everything in the <code>dist</code> directory to the commit. After the commit, it pushes the new commit and tag up to the server, and deletes the <code>build/temp</code> directory.</p>
<h1><a class="anchor" id="autotoc_md14904"></a>
API</h1>
<h2><a class="anchor" id="autotoc_md14905"></a>
&lt;tt&gt;npmVersion(newversion, options = {}) -&gt; Promise&lt;String&gt;&lt;/tt&gt;</h2>
<p class="">Do the things. Returns a promise that resolves to the new version if all is well, or rejects if any errors are encountered.</p>
<h2><a class="anchor" id="autotoc_md14906"></a>
Options</h2>
<h3><a class="anchor" id="autotoc_md14907"></a>
&lt;tt&gt;path&lt;/tt&gt; String</h3>
<p class="">The path to the package being versionified. Defaults to <a class="el" href="namespaceupdate-gyp.html#a353f325a85a850b0456a7cbaff8fc43b">process.cwd()</a>.</p>
<h3><a class="anchor" id="autotoc_md14908"></a>
&lt;tt&gt;allowSameVersion&lt;/tt&gt; Boolean</h3>
<p class="">Allow setting the version to the current version in package.json. Default <code>false</code>.</p>
<h3><a class="anchor" id="autotoc_md14909"></a>
&lt;tt&gt;preid&lt;/tt&gt; String</h3>
<p class="">When the <code>newversion</code> is pre, premajor, preminor, or prepatch, this defines the prerelease string, like 'beta' etc.</p>
<h3><a class="anchor" id="autotoc_md14910"></a>
&lt;tt&gt;tagVersionPrefix&lt;/tt&gt; String</h3>
<p class="">The prefix to add to the raw semver string for the tag name. Defaults to &lsquo;'v&rsquo;&lsquo;. (So, by default it tags as 'v1.2.3&rsquo; when versioning to 1.2.3.)</p>
<h3><a class="anchor" id="autotoc_md14911"></a>
&lt;tt&gt;commitHooks&lt;/tt&gt; Boolean</h3>
<p class="">Run git commit hooks. Default true.</p>
<h3><a class="anchor" id="autotoc_md14912"></a>
&lt;tt&gt;gitTagVersion&lt;/tt&gt; Boolean</h3>
<p class="">Tag the version, default true.</p>
<h3><a class="anchor" id="autotoc_md14913"></a>
&lt;tt&gt;signGitCommit&lt;/tt&gt; Boolean</h3>
<p class="">GPG sign the git commit. Default <code>false</code>.</p>
<h3><a class="anchor" id="autotoc_md14914"></a>
&lt;tt&gt;signGitTag&lt;/tt&gt; Boolean</h3>
<p class="">GPG sign the git tag. Default <code>false</code>.</p>
<h3><a class="anchor" id="autotoc_md14915"></a>
&lt;tt&gt;force&lt;/tt&gt; Boolean</h3>
<p class="">Push forward recklessly if any problems happen. Default <code>false</code>.</p>
<h3><a class="anchor" id="autotoc_md14916"></a>
&lt;tt&gt;ignoreScripts&lt;/tt&gt; Boolean</h3>
<p class="">Do not run pre/post/version lifecycle scripts. Default <code>false</code>.</p>
<h3><a class="anchor" id="autotoc_md14917"></a>
&lt;tt&gt;scriptShell&lt;/tt&gt; String</h3>
<p class="">Path to the shell, which should execute the lifecycle scripts. Defaults to <code>/bin/sh</code> on unix, or <code>cmd.exe</code> on windows.</p>
<h3><a class="anchor" id="autotoc_md14918"></a>
&lt;tt&gt;message&lt;/tt&gt; String</h3>
<p class="">The message for the git commit and annotated git tag that are created. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
