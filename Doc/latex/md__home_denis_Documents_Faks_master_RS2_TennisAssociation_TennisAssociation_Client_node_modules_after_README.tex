Invoke callback after n calls\hypertarget{md__home_denis_Documents_Faks_master_RS2_TennisAssociation_TennisAssociation_Client_node_modules_after_README_autotoc_md21673}{}\doxysection{Status\+: production ready}\label{md__home_denis_Documents_Faks_master_RS2_TennisAssociation_TennisAssociation_Client_node_modules_after_README_autotoc_md21673}
\hypertarget{md__home_denis_Documents_Faks_master_RS2_TennisAssociation_TennisAssociation_Client_node_modules_after_README_autotoc_md21674}{}\doxysection{Example}\label{md__home_denis_Documents_Faks_master_RS2_TennisAssociation_TennisAssociation_Client_node_modules_after_README_autotoc_md21674}

\begin{DoxyCode}{0}
\DoxyCodeLine{var after = require("{}after"{})}
\DoxyCodeLine{var db = require("{}./db"{}) // some db.}
\DoxyCodeLine{}
\DoxyCodeLine{var updateUser = function (req, res) \{}
\DoxyCodeLine{  // use after to run two tasks in parallel,}
\DoxyCodeLine{  // namely get request body and get session}
\DoxyCodeLine{  // then run updateUser with the results}
\DoxyCodeLine{  var next = after(2, updateUser)}
\DoxyCodeLine{  var results = \{\}}
\DoxyCodeLine{  }
\DoxyCodeLine{  getJSONBody(req, res, function (err, body) \{}
\DoxyCodeLine{    if (err) return next(err)}
\DoxyCodeLine{    }
\DoxyCodeLine{    results.body = body}
\DoxyCodeLine{    next(null, results)}
\DoxyCodeLine{  \})}
\DoxyCodeLine{  }
\DoxyCodeLine{  getSessionUser(req, res, function (err, user) \{}
\DoxyCodeLine{    if (err) return next(err)}
\DoxyCodeLine{    }
\DoxyCodeLine{    results.user = user}
\DoxyCodeLine{    next(null, results)}
\DoxyCodeLine{  \})}
\DoxyCodeLine{  }
\DoxyCodeLine{  // now do the thing!}
\DoxyCodeLine{  function updateUser(err, result) \{}
\DoxyCodeLine{    if (err) \{}
\DoxyCodeLine{      res.statusCode = 500}
\DoxyCodeLine{      return res.end("{}Unexpected Error"{})}
\DoxyCodeLine{    \}}
\DoxyCodeLine{    }
\DoxyCodeLine{    if (!result.user || result.user.role !== "{}admin"{}) \{}
\DoxyCodeLine{      res.statusCode = 403}
\DoxyCodeLine{      return res.end("{}Permission Denied"{})}
\DoxyCodeLine{    \}}
\DoxyCodeLine{    }
\DoxyCodeLine{    db.put("{}users:"{} + req.params.userId, result.body, function (err) \{}
\DoxyCodeLine{      if (err) \{}
\DoxyCodeLine{        res.statusCode = 500}
\DoxyCodeLine{        return res.end("{}Unexpected Error"{})}
\DoxyCodeLine{      \}}
\DoxyCodeLine{      }
\DoxyCodeLine{      res.statusCode = 200}
\DoxyCodeLine{      res.end("{}Ok"{})  }
\DoxyCodeLine{    \})   }
\DoxyCodeLine{  \}}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__home_denis_Documents_Faks_master_RS2_TennisAssociation_TennisAssociation_Client_node_modules_after_README_autotoc_md21675}{}\doxysection{Naive Example}\label{md__home_denis_Documents_Faks_master_RS2_TennisAssociation_TennisAssociation_Client_node_modules_after_README_autotoc_md21675}

\begin{DoxyCode}{0}
\DoxyCodeLine{var after = require("{}after"{})}
\DoxyCodeLine{    , next = after(3, logItWorks)}
\DoxyCodeLine{}
\DoxyCodeLine{next()}
\DoxyCodeLine{next()}
\DoxyCodeLine{next() // it works}
\DoxyCodeLine{}
\DoxyCodeLine{function logItWorks() \{}
\DoxyCodeLine{    console.log("{}it works!"{})}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__home_denis_Documents_Faks_master_RS2_TennisAssociation_TennisAssociation_Client_node_modules_after_README_autotoc_md21676}{}\doxysection{Example with error handling}\label{md__home_denis_Documents_Faks_master_RS2_TennisAssociation_TennisAssociation_Client_node_modules_after_README_autotoc_md21676}

\begin{DoxyCode}{0}
\DoxyCodeLine{var after = require("{}after"{})}
\DoxyCodeLine{    , next = after(3, logError)}
\DoxyCodeLine{}
\DoxyCodeLine{next()}
\DoxyCodeLine{next(new Error("{}oops"{})) // logs oops}
\DoxyCodeLine{next() // does nothing}
\DoxyCodeLine{}
\DoxyCodeLine{// This callback is only called once.}
\DoxyCodeLine{// If there is an error the callback gets called immediately}
\DoxyCodeLine{// this avoids the situation where errors get lost.}
\DoxyCodeLine{function logError(err) \{}
\DoxyCodeLine{    console.log(err)}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md__home_denis_Documents_Faks_master_RS2_TennisAssociation_TennisAssociation_Client_node_modules_after_README_autotoc_md21677}{}\doxysection{Installation}\label{md__home_denis_Documents_Faks_master_RS2_TennisAssociation_TennisAssociation_Client_node_modules_after_README_autotoc_md21677}
{\ttfamily npm install after}\hypertarget{md__home_denis_Documents_Faks_master_RS2_TennisAssociation_TennisAssociation_Client_node_modules_after_README_autotoc_md21678}{}\doxysection{Tests}\label{md__home_denis_Documents_Faks_master_RS2_TennisAssociation_TennisAssociation_Client_node_modules_after_README_autotoc_md21678}
{\ttfamily npm test}\hypertarget{md__home_denis_Documents_Faks_master_RS2_TennisAssociation_TennisAssociation_Client_node_modules_after_README_autotoc_md21679}{}\doxysection{Contributors}\label{md__home_denis_Documents_Faks_master_RS2_TennisAssociation_TennisAssociation_Client_node_modules_after_README_autotoc_md21679}

\begin{DoxyItemize}
\item Raynos
\item defunctzombie
\end{DoxyItemize}\hypertarget{md__home_denis_Documents_Faks_master_RS2_TennisAssociation_TennisAssociation_Client_node_modules_after_README_autotoc_md21680}{}\doxysection{MIT Licenced}\label{md__home_denis_Documents_Faks_master_RS2_TennisAssociation_TennisAssociation_Client_node_modules_after_README_autotoc_md21680}
